<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <!-- Cache control to prevent stale location data -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>PhillyTap</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css" />
    
    <!-- Google Analytics -->
    <!-- Replace YOUR_GA_ID with your Google Analytics 4 Measurement ID (G-XXXXXXXXXX) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-C4NS99ES13"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-C4NS99ES13', {
        anonymize_ip: true,
        cookie_flags: 'SameSite=None;Secure'
      });
    </script>
</head>
<body>
    <div id="map"></div>
    <div id="game-panel">
        <button id="minimize-btn" onclick="toggleMinimize()" title="Expand">+</button>
        <div id="game-content">
            <div id="date-indicator">
                <div class="date-value" id="date-display">Loading date...</div>
                <div class="location-source" id="location-source-display"></div>
            </div>
            <div id="progress-indicator">Location <span id="current-location-number">1</span> of <span id="total-locations">5</span></div>
            <div id="multiplier-indicator"></div>
            <div class="location-and-score-container">
                <div id="current-location">
                    <div id="current-location-photo-container" style="display: none;">
                        <img id="current-location-photo" src="" alt="Location photo" onclick="openPhotoModal()">
                        <div id="photo-tap-hint">Tap to zoom</div>
                    </div>
                    <div id="current-location-display">
                        <div id="current-location-icon">üîî</div>
                        <div id="current-location-name">
                            <span>Loading...</span>
                            <span id="location-info-btn" style="display: none;" onclick="showLocationInfo()" title="Learn more">‚ÑπÔ∏è</span>
                        </div>
                    </div>
                </div>
                <div id="running-score">
                    <div id="running-score-label">Running Total</div>
                    <div id="running-score-value">0</div>
                </div>
            </div>
            <div id="current-location-instruction">Tap the location on the map</div>
        </div>
        <div id="completion-screen">
            <div id="final-score">0</div>
            <div id="running-score-label">Final Score</div>
            <table id="results-table">
                <thead>
                    <tr>
                        <th class="location-icon">üìç</th>
                        <th>Location</th>
                        <th>Distance</th>
                        <th class="score">Score</th>
                    </tr>
                </thead>
                <tbody id="results-table-body">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
            <button id="share-score-btn" onclick="shareScore()">üì§ Share Score</button>
            <div id="scorecard-hint">Tap any location to learn more</div>
            <div id="share-feedback">Copied to clipboard! üéâ</div>
        </div>
    </div>
    <div id="next-location-overlay">
        <div id="next-location-message">Next Location!</div>
        <div id="next-location-photo-container" style="display: none;">
            <img id="next-location-photo" src="" alt="Location photo">
        </div>
        <div id="next-location-display">
            <div id="next-location-icon">üîî</div>
            <div id="next-location-name">Loading...</div>
        </div>
    </div>
    
    <!-- Location info modal/bottom sheet -->
    <div id="location-info-overlay" onclick="hideLocationInfo()"></div>
    <div id="location-info-modal">
        <div id="location-info-header">
            <div style="display: flex; align-items: center;">
                <span id="location-info-icon">üîî</span>
                <div id="location-info-title">Location Name</div>
            </div>
            <button id="location-info-close" onclick="hideLocationInfo()" aria-label="Close">√ó</button>
        </div>
        <div id="location-info-content">No information available for this location.</div>
    </div>
    <div id="quick-score">
        <div id="quick-score-value">0</div>
        <div id="quick-score-label">Points</div>
    </div>
    
    <!-- Photo Modal -->
    <div id="photo-modal" class="photo-modal" onclick="closePhotoModal(event)">
        <div class="photo-modal-content" onclick="event.stopPropagation()">
            <img id="photo-modal-image" src="" alt="Location photo" onclick="closePhotoModal()">
            <div id="photo-minimize-hint">Tap photo to minimize</div>
        </div>
    </div>
    
    <!-- Guess confirmation button -->
    <button id="confirm-guess-btn" onclick="confirmGuess()">
        <span>‚úì</span>
        <span>Confirm Guess</span>
    </button>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- js-yaml for parsing YAML files -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    
    <!-- Application JavaScript modules (load in dependency order) -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/analytics.js"></script>
    <script src="js/gameState.js"></script>
    <script src="js/locations.js"></script>
    <script src="js/map.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/gameLogic.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
